server.port=8080
server.forward-headers-strategy=native
# Đảm bảo Tomcat nhận diện đúng HTTPS từ Nginx
server.tomcat.remoteip.protocol-header=x-forwarded-proto
server.tomcat.remoteip.remote-ip-header=x-forwarded-for
server.tomcat.remoteip.internal-proxies=.*
server.tomcat.use-relative-redirects=true

# PostgreSQL
spring.datasource.url=${DB_URL:jdbc:postgresql://localhost:5432/exe201_phapluatso_v2}
spring.datasource.username=${DB_USERNAME:postgres}
spring.datasource.password=${DB_PASSWORD:Nguyenhuutai315@}
spring.datasource.driver-class-name=org.postgresql.Driver

# JPA
spring.jpa.hibernate.ddl-auto=validate
spring.jpa.open-in-view=false

# Flyway
spring.flyway.enabled=true
spring.flyway.validate-on-migrate=true
spring.flyway.clean-disabled=true
spring.flyway.baseline-on-migrate=true

# JWT
app.jwt.secret=${JWT_SECRET:CHANGE_ME_TO_A_LONG_RANDOM_SECRET_AT_LEAST_32_CHARS}
app.jwt.access-minutes=1440
app.jwt.refresh-days=30

# Google OAuth2
spring.security.oauth2.client.registration.google.client-id=${GOOGLE_CLIENT_ID:your-client-id}
spring.security.oauth2.client.registration.google.client-secret=${GOOGLE_CLIENT_SECRET:your-client-secret}
spring.security.oauth2.client.registration.google.scope=openid,profile,email
# Force account picker on every login (allows switching accounts)
spring.security.oauth2.client.provider.google.authorization-uri=https://accounts.google.com/o/oauth2/v2/auth?prompt=select_account

# redirect after google login (frontend test page)
app.frontend.redirect-url=${FRONTEND_REDIRECT_URL:http://localhost:8080/html/oauth2-redirect.html}
app.frontend.base-url=${FRONTEND_BASE_URL:http://localhost:8080}

# AI Configuration
# Using OpenAI GPT-4o-mini for production
ai.openai.api-key=${OPENAI_API_KEY:your-api-key}
ai.openai.model=gpt-4o-mini

# File Upload
spring.servlet.multipart.max-file-size=10MB
spring.servlet.multipart.max-request-size=10MB

# Logging - Use ENV vars to control log levels (default: DEBUG for dev, set to INFO/WARN for production)
logging.level.root=${LOG_LEVEL_ROOT:DEBUG}
logging.level.com.htai.exe201phapluatso=${LOG_LEVEL_APP:DEBUG}
logging.level.org.springframework.web=${LOG_LEVEL_SPRING_WEB:DEBUG}
logging.level.org.hibernate.SQL=${LOG_LEVEL_HIBERNATE_SQL:DEBUG}
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=${LOG_LEVEL_HIBERNATE_BINDER:TRACE}
logging.level.org.springframework.transaction=${LOG_LEVEL_TRANSACTION:DEBUG}
logging.level.com.htai.exe201phapluatso.payment.service.VNPayService=${LOG_LEVEL_VNPAY:DEBUG}
logging.level.com.htai.exe201phapluatso.credit.service.CreditService=${LOG_LEVEL_CREDIT:DEBUG}
logging.level.com.htai.exe201phapluatso.config.EnvLoader=${LOG_LEVEL_ENVLOADER:DEBUG}
logging.level.com.htai.exe201phapluatso.config.DotEnvEnvironmentPostProcessor=${LOG_LEVEL_DOTENV:DEBUG}

# OAuth2 and Security Debug Logging
logging.level.org.springframework.security=${LOG_LEVEL_SECURITY:DEBUG}
logging.level.org.springframework.security.oauth2=${LOG_LEVEL_OAUTH2:DEBUG}
logging.level.org.springframework.security.oauth2.client=${LOG_LEVEL_OAUTH2_CLIENT:DEBUG}
logging.level.com.htai.exe201phapluatso.auth.oauth2=${LOG_LEVEL_AUTH_OAUTH2:DEBUG}
logging.level.com.htai.exe201phapluatso.auth.util.CookieUtils=${LOG_LEVEL_COOKIE:DEBUG}
logging.level.reactor.netty=${LOG_LEVEL_REACTOR_NETTY:INFO}

# Error Response - Hide details in production via ENV
server.error.include-message=${ERROR_INCLUDE_MESSAGE:always}
server.error.include-stacktrace=${ERROR_INCLUDE_STACKTRACE:always}
server.error.include-exception=${ERROR_INCLUDE_EXCEPTION:true}

# Database Connection Pool (HikariCP)
spring.datasource.hikari.maximum-pool-size=${HIKARI_MAX_POOL_SIZE:10}
spring.datasource.hikari.minimum-idle=${HIKARI_MIN_IDLE:5}
spring.datasource.hikari.connection-timeout=${HIKARI_CONNECTION_TIMEOUT:30000}
spring.datasource.hikari.idle-timeout=${HIKARI_IDLE_TIMEOUT:600000}
spring.datasource.hikari.max-lifetime=${HIKARI_MAX_LIFETIME:1800000}

# PayOS Configuration
payos.client-id=${PAYOS_CLIENT_ID:your-client-id}
payos.api-key=${PAYOS_API_KEY:your-api-key}
payos.checksum-key=${PAYOS_CHECKSUM_KEY:your-checksum-key}
payos.return-url=${PAYOS_RETURN_URL:http://localhost:8080/html/payment-result.html}
payos.cancel-url=${PAYOS_CANCEL_URL:http://localhost:8080/html/plans.html}

# Payment Configuration
payment.spam-block-minutes=10
payment.cleanup-interval-minutes=5
payment.stale-payment-minutes=5
payment.max-cleanup-batch-size=20
payment.max-retries=3
payment.retry-base-delay-ms=500
# Reuse existing payment link instead of creating new one (recommended for production)
# When reusing, QR code will be generated from checkout URL (user can still pay via PayOS page)
payment.reuse-pending-payment=true
# Test mode: disable spam protection (for development only)
# WARNING: Set to false in production!
payment.test-mode=false

# Email Configuration (Gmail SMTP)
# Set spring.mail.enabled=true when you have configured email
spring.mail.enabled=${MAIL_ENABLED:false}
spring.mail.host=${MAIL_HOST:smtp.gmail.com}
spring.mail.port=${MAIL_PORT:587}
spring.mail.username=${MAIL_USERNAME:your-email@gmail.com}
spring.mail.password=${MAIL_PASSWORD:your-app-password}
spring.mail.properties.mail.smtp.auth=true
spring.mail.properties.mail.smtp.starttls.enable=true
spring.mail.properties.mail.smtp.starttls.required=true

# Enable scheduling for OTP cleanup
spring.task.scheduling.enabled=true

# Vector Search / Embedding Configuration
# Auto-generate embeddings for new articles (disabled - use admin panel instead)
embedding.auto-generate.enabled=false
embedding.auto-generate.batch-size=10

# ============================================
# Security Configuration
# ============================================

# CORS - Allow localhost for development, plus environment variable for production
app.security.cors.allowed-origins=${ALLOWED_ORIGINS:http://localhost:8080,http://127.0.0.1:8080}
app.security.cors.allow-credentials=${CORS_ALLOW_CREDENTIALS:true}
app.security.cors.allowed-methods=GET,POST,PUT,DELETE,PATCH,OPTIONS
app.security.cors.allowed-headers=Authorization,Content-Type,X-Requested-With
app.security.cors.exposed-headers=Authorization

# Cookies - Lax for development (allows some cross-site)
app.security.cookie.same-site=${COOKIE_SAME_SITE:Lax}
app.security.cookie.secure=${COOKIE_SECURE:false}
app.security.cookie.domain=${COOKIE_DOMAIN:}

# CSRF - Disabled for development simplicity
app.security.csrf.enabled=${CSRF_ENABLED:false}

# Frontend URLs - Local development
app.frontend.base-url=${FRONTEND_BASE_URL:http://localhost:8080}
app.frontend.redirect-url=${FRONTEND_REDIRECT_URL:http://localhost:8080/html/oauth2-redirect.html}

# Rate Limiting Configuration
# Login: 5 attempts per 60 seconds per IP
app.rate-limit.login.limit=5
app.rate-limit.login.window-seconds=60

# Register: 3 attempts per 60 seconds per IP
app.rate-limit.register.limit=3
app.rate-limit.register.window-seconds=60

# Password Reset: 3 attempts per 60 seconds per IP
app.rate-limit.password-reset.limit=3
app.rate-limit.password-reset.window-seconds=60

# Default rate limit for other endpoints
app.rate-limit.default.limit=100
app.rate-limit.default.window-seconds=60

# Account Lockout Configuration
# Lock account after 5 failed login attempts
app.security.lockout.max-attempts=5
# Lock duration in minutes
app.security.lockout.duration-minutes=15

# ============================================
# Redis Configuration (Optional - fallback to in-memory if not available)
# ============================================
spring.data.redis.host=${REDIS_HOST:localhost}
spring.data.redis.port=${REDIS_PORT:6379}
spring.data.redis.password=${REDIS_PASSWORD:}
spring.data.redis.timeout=5000ms

# ============================================
# Quiz Configuration
# ============================================
# Session timeout in hours (valid range: 0.5 to 4 hours)
app.quiz.session-timeout-hours=2

# Duration validation (in minutes)
app.quiz.min-duration-minutes=5
app.quiz.max-duration-minutes=180
app.quiz.default-duration-minutes=45

# ============================================
# Payment Idempotency Configuration
# ============================================
# Idempotency key expiration in hours (default: 24)
payment.idempotency.expiration-hours=24
# Cleanup cron expression (default: 4:00 AM daily)
payment.idempotency.cleanup-cron=0 0 4 * * ?

# ============================================
# Credit Reservation Configuration
# ============================================
# Reservation timeout in minutes (default: 5)
credit.reservation.timeout-minutes=5
# Enable cleanup scheduler (default: true)
credit.reservation.cleanup.enabled=true
# Cleanup interval in milliseconds (default: 60000 = 1 minute)
credit.reservation.cleanup.interval-ms=60000

logging.level.org.springframework.boot.autoconfigure.data.redis=DEBUG
logging.level.org.springframework.data.redis=DEBUG

# ============================================
# Payment Status Token Configuration
# ============================================
# Secret key for signing payment status tokens (HMAC-SHA256)
# Generate a secure random string: openssl rand -base64 32
payment.status-token-secret=${PAYMENT_STATUS_TOKEN_SECRET:CHANGE_ME_TO_A_SECURE_RANDOM_SECRET_AT_LEAST_32_CHARS}
# Token time-to-live in minutes (default: 10)
payment.status-token-ttl-minutes=15


# Cloudinary
cloudinary.cloud-name=
cloudinary.api-key=
cloudinary.api-secret=
