<!doctype html>
<html>
<head><meta charset="utf-8"><title>App (dev)</title></head>
<body style="font-family:system-ui;margin:40px">
<h2>App Test (dev)</h2>
<button onclick="me()">GET me</button>
<button onclick="refresh()">POST refresh</button>
<button onclick="logout()">POST logout</button>
<pre id="out"></pre>

<script>
    const out = document.getElementById("out");
    const show = x => out.textContent = typeof x === "string" ? x : JSON.stringify(x,null,2);

    async function me(){
        try {
            const client = AppRuntime.getClient();
            if (!client) {
                show({status: 503, body: 'API client not available'});
                return;
            }
            const data = await AppRuntime.safe('DevApp:me', () => AppRuntime.getMe(client));
            show({status: 200, body: data});
        } catch (err) {
            show({status: err.status || 500, body: err});
        }
    }

    async function refresh(){
        try {
            const ok = await window.TokenManager?.refreshAccessToken();
            const token = window.TokenManager?.getAccessToken();
            show({ refreshed: ok, accessToken: token || null });
        } catch (err) {
            show({ error: err });
        }
    }

    async function logout(){
        try {
            await window.TokenManager?.logout();
            show({ status: 'ok' });
        } catch (err) {
            show({ error: err });
        }
    }
</script>
</body>
</html>


