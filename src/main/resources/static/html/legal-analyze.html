<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Analyze PDF</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/toast-notification.css">
</head>
<body>
<div class="container mt-5">
    <h2>Phân Tích File PDF</h2>
    <p class="text-muted">Upload file để xem tất cả pattern "Điều" trong file</p>
    
    <div class="card">
        <div class="card-body">
            <input type="file" class="form-control" id="fileInput" accept=".pdf">
            <button class="btn btn-primary mt-3" onclick="analyze()">Phân Tích</button>
        </div>
    </div>
    
    <div id="result" class="mt-4"></div>
</div>

<script src="/scripts/toast-notification.js"></script>
<script>
async function analyze() {
    const file = document.getElementById('fileInput').files[0];
    if (!file) {
        Toast.warning('Vui lòng chọn file PDF');
        return;
    }

    const formData = new FormData();
    formData.append('file', file);

    const token = localStorage.getItem('accessToken');
    const res = await fetch('/api/legal/analyze/pdf', {
        method: 'POST',
        headers: { 'Authorization': `Bearer ${token}` },
        body: formData
    });

    const data = await res.json();
    displayResult(data);
}

function displayResult(data) {
    const html = `
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h5>Kết Quả Phân Tích</h5>
            </div>
            <div class="card-body">
                <h6>Thông tin chung:</h6>
                <ul>
                    <li>Độ dài text: ${data.totalLength.toLocaleString()} ký tự</li>
                    <li>Số điều duy nhất: ${data.patterns.unique_articles}</li>
                </ul>

                <h6 class="mt-3">Pattern 1: "Điều X." (có dấu chấm)</h6>
                <p>Tìm thấy: <strong>${data.patterns.pattern1_count}</strong> lần</p>
                <div class="bg-light p-2 small">
                    ${data.patterns.pattern1_samples.map(s => `<div class="mb-1">${s}</div>`).join('')}
                </div>

                <h6 class="mt-3">Pattern 2: "Điều X" (không dấu chấm)</h6>
                <p>Tìm thấy: <strong>${data.patterns.pattern2_count}</strong> lần</p>
                <div class="bg-light p-2 small">
                    ${data.patterns.pattern2_samples.map(s => `<div class="mb-1">${s}</div>`).join('')}
                </div>

                <h6 class="mt-3">Pattern 3: "ĐiềuX" (không space)</h6>
                <p>Tìm thấy: <strong>${data.patterns.pattern3_count}</strong> lần</p>
                <div class="bg-light p-2 small">
                    ${data.patterns.pattern3_samples.map(s => `<div class="mb-1">${s}</div>`).join('')}
                </div>

                <h6 class="mt-3">Danh sách số điều:</h6>
                <div class="bg-light p-2 small" style="max-height: 200px; overflow-y: auto;">
                    ${JSON.stringify(data.patterns.article_numbers)}
                </div>

                <h6 class="mt-3">Preview text (1000 ký tự đầu):</h6>
                <pre class="bg-light p-2 small" style="max-height: 300px; overflow-y: auto;">${data.preview}</pre>
            </div>
        </div>
    `;
    document.getElementById('result').innerHTML = html;
}
</script>
</body>
</html>
